<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Solicitud de Retiro — Lionel</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <meta name="description" content="Formulario de retiro - Retiros 24hs, 1 por persona por día.">

  <!-- Meta Pixel (reemplaza 'TU_PIXEL_ID') -->
  <script>
    /*! Meta Pixel placeholder - reemplaza TU_PIXEL_ID por tu id real */
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
    n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
    document,'script','https://connect.facebook.net/en_US/fbevents.js');
    try{ fbq('init','TU_PIXEL_ID'); fbq('track','PageView'); }catch(e){console.warn(e)}
  </script>

  <style>
    :root{
      --bg1: #08142a; /* fondo oscuro */
      --bg2: #06253f; /* degradado */
      --card: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.06));
      --accent: #00d1ff; /* cyan brillante */
      --accent-2: #00a3ff;
      --gold: #ffd166;
      --white: #ffffff;
      --muted: #bfc9d9;
      --radius: 18px;
      --glass: rgba(255,255,255,0.04);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Montserrat',system-ui,Arial;
      background: linear-gradient(180deg,var(--bg1),var(--bg2));
      color:var(--white);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .container{
      width:100%;
      max-width:920px;
      background:var(--card);
      border-radius:22px;
      box-shadow:0 20px 60px rgba(2,6,23,0.6);
      overflow:hidden;
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:0;
      border:1px solid rgba(255,255,255,0.04);
    }

    /* Left hero */
    .hero{
      padding:34px;
      background:
        radial-gradient(600px 200px at 10% 10%, rgba(0,209,255,0.04), transparent 10%),
        linear-gradient(135deg, rgba(0,160,255,0.06), rgba(0,112,204,0.03));
    }
    .brand {
      display:flex;
      gap:14px;
      align-items:center;
      margin-bottom:18px;
    }
    .logo{
      width:64px;height:64px;border-radius:14px;
      background: linear-gradient(135deg,var(--accent),var(--accent-2));
      display:flex;align-items:center;justify-content:center;
      color:#012; font-weight:800; font-size:20px; box-shadow:0 6px 22px rgba(0,209,255,0.08) inset;
    }
    .brand h1{margin:0;font-size:20px;letter-spacing:0.4px}
    .subtitle{color:var(--muted);margin-top:6px;font-size:13px}

    .hero h2{
      margin:18px 0 8px 0;font-size:28px;line-height:1.05;
    }
    .hero p.lead{color:var(--muted); margin-bottom:22px}

    .info-grid{
      display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:20px;
    }
    .info-card{
      background:var(--glass);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);
      font-size:13px;
    }
    .info-card strong{display:block;color:var(--white);font-size:15px}

    /* Right form column */
    .form-wrap{
      padding:28px;
      background: linear-gradient(180deg, rgba(0,0,0,0.04), rgba(255,255,255,0.01));
      display:flex;flex-direction:column;justify-content:center;
    }
    form{width:100%}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"], input[type="tel"], input[type="number"], textarea, select{
      width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.05);
      background:transparent;color:var(--white);outline:none;font-size:15px;
      transition:box-shadow .12s, border .12s;
      -webkit-appearance:none;
    }
    input:focus, textarea:focus{
      box-shadow:0 6px 20px rgba(0,209,255,0.06);
      border-color:var(--accent);
    }
    .small{font-size:13px;color:var(--muted);margin-top:8px}

    .row{display:flex;gap:12px}
    .col{flex:1}

    .cta{
      margin-top:16px;
      display:flex;gap:12px;align-items:center;
    }
    .btn{
      flex:1;padding:14px 18px;border-radius:12px;background:linear-gradient(90deg,var(--accent),var(--accent-2));
      border:none;color:#022;font-weight:700;font-size:15px;cursor:pointer;box-shadow:0 10px 30px rgba(0,160,255,0.12);
    }
    .btn:disabled{opacity:0.45;cursor:not-allowed}
    .btn-ghost{
      padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.06);
      background:transparent;color:var(--white);font-weight:600;cursor:pointer;
    }

    .muted-note{font-size:12px;color:var(--muted);margin-top:10px}

    footer.legal{padding:14px 20px;background:rgba(0,0,0,0.03);font-size:13px;color:var(--muted)}
    footer.legal a{color:var(--accent);text-decoration:none}

    /* responsive */
    @media (max-width:940px){
      .container{grid-template-columns: 1fr; max-width:720px}
      .form-wrap{order:2}
    }

    /* small helper */
    .error{color:#ff7b7b;font-size:13px;margin-top:8px}
    .success{color:#b6ffda;font-size:14px;margin-top:8px}
    .pill{
      display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03);
      border:1px solid rgba(255,255,255,0.02);font-weight:600;font-size:13px
    }

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center;z-index:9999}
    .modal{background:linear-gradient(180deg,#071526,#0b2b3f);padding:22px;border-radius:16px;max-width:520px;width:92%;box-shadow:0 30px 80px rgba(0,0,0,0.6)}
    .modal h3{margin-top:0}
  </style>
</head>
<body>

  <div class="container" role="main" aria-labelledby="title">
    <!-- LEFT HERO -->
    <div class="hero" aria-hidden="false">
      <div class="brand">
        <div class="logo">L</div>
        <div>
          <h1 id="title">Lionel — Retiros 24hs</h1>
          <div class="subtitle">Retiros automáticos todos los días — 1 por persona por día</div>
        </div>
      </div>

      <h2>Solicitá tu retiro en menos de 1 minuto</h2>
      <p class="lead">Completá los datos exactos: teléfono donde jugaste, usuario, cuánto ganaste y alias/CBU para depositarte. Procesamos retiros las 24 horas, todos los días.</p>

      <div class="info-grid" aria-hidden="false">
        <div class="info-card">
          <strong>Retiros 24/7</strong>
          Procesamos retiros en cualquier horario, 24 horas todos los días.
        </div>
        <div class="info-card">
          <strong>1 por persona/día</strong>
          Para evitar duplicados solo se permite 1 solicitud por persona cada 24 horas.
        </div>
        <div class="info-card">
          <strong>Validación</strong>
          Requerimos comprobante y validación: el depósito se realiza al alias/CBU ingresado.
        </div>
        <div class="info-card">
          <strong>Soporte</strong>
          Si algo falla, te damos el link directo a WhatsApp para cerrar manualmente.
        </div>
      </div>

      <div style="margin-top:22px">
        <span class="pill">Importante</span>
        <div class="muted-note">Ingresá los datos EXACTOS para evitar demoras en la acreditación.</div>
      </div>
    </div>

    <!-- RIGHT FORM -->
    <div class="form-wrap" aria-labelledby="formTitle">
      <h3 id="formTitle" style="margin:0 0 12px 0">Formulario de retiro</h3>

      <form id="withdrawForm" autocomplete="off" novalidate>
        <div style="margin-bottom:12px">
          <label for="phone">Teléfono donde jugaste</label>
          <input id="phone" name="phone" type="tel" placeholder="Ej: 11 6XXX XXXX" required>
        </div>

        <div style="margin-bottom:12px">
          <label for="username">Usuario (en la plataforma)</label>
          <input id="username" name="username" type="text" placeholder="Tu usuario" required>
        </div>

        <div class="row" style="margin-bottom:12px">
          <div class="col">
            <label for="amount">Monto ganado (USD/ARS)</label>
            <input id="amount" name="amount" type="number" min="1" step="0.01" placeholder="Ej: 1500" required>
          </div>
          <div class="col">
            <label for="currency">Moneda</label>
            <select id="currency" name="currency" required>
              <option value="ARS">ARS</option>
              <option value="USD">USD</option>
            </select>
          </div>
        </div>

        <div style="margin-bottom:12px">
          <label for="alias">Alias o CBU (para depositar)</label>
          <input id="alias" name="alias" type="text" placeholder="Alias o CBU (22 dígitos)" required>
          <div class="small">Si ingresás CBU debe tener 22 dígitos. Si es alias, verificá que esté correcto.</div>
        </div>

        <div style="margin-bottom:12px">
          <label for="bank">Banco (opcional)</label>
          <input id="bank" name="bank" type="text" placeholder="Banco / entidad (opcional)">
        </div>

        <div style="margin-bottom:6px">
          <label for="note">Comentario / Comprobante (opcional)</label>
          <textarea id="note" name="note" rows="2" placeholder="Si ya subiste comprobante, indica referencia"></textarea>
        </div>

        <div style="display:flex;gap:10px;align-items:center;margin-top:10px">
          <input id="terms" type="checkbox" required>
          <label for="terms" style="margin:0;font-size:13px;color:var(--muted)">Confirmo que los datos son correctos y solicito un retiro (1 por día).</label>
        </div>

        <div id="formError" class="error" role="alert" style="display:none"></div>
        <div id="formSuccess" class="success" role="status" style="display:none"></div>

        <div class="cta">
          <button id="submitBtn" class="btn" type="submit">Solicitar retiro</button>
          <button id="whatsBtn" type="button" class="btn-ghost">Abrir en WhatsApp</button>
        </div>

        <div class="muted-note">Al enviar aceptás que verifiquemos la cuenta y el comprobante. Si hay inconsistencias el retiro puede ser rechazado.</div>
      </form>

      <footer class="legal">
        <div><strong>Retiros:</strong> Procesamos 24 horas, TODOS los días. <strong>Límite:</strong> 1 solicitud por persona cada 24 horas.</div>
        <div style="margin-top:8px">¿Problemas? <a href="#" id="openWaFooter">Contactá soporte por WhatsApp</a></div>
      </footer>
    </div>
  </div>

  <!-- modal -->
  <div class="modal-backdrop" id="modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Solicitud enviada</h3>
      <p id="modalText">Tu solicitud se envió correctamente. Te notificaremos por WhatsApp cuando el retiro esté aprobado.</p>
      <div style="display:flex;gap:8px;margin-top:16px">
        <button id="modalOk" class="btn">Perfecto</button>
        <button id="modalClose" class="btn-ghost">Cerrar</button>
      </div>
    </div>
  </div>

  <script>
    // ---------- Config ----------
    const API_ENDPOINT = '/api/withdraw'; // <- reemplaza por tu endpoint real
    const WHATS_PHONE = '54911XXXXYYYY'; // <- número de soporte en formato internacional sin '+' (ej: 54911...)
    const WHATS_TEMPLATE = true; // si querés usar un template distinto, lo adaptás acá

    // ---------- Helpers ----------
    const $ = id => document.getElementById(id);
    const form = $('withdrawForm');
    const submitBtn = $('submitBtn');
    const whatsBtn = $('whatsBtn');
    const errorBox = $('formError');
    const successBox = $('formSuccess');
    const modal = $('modal');
    const modalOk = $('modalOk');
    const modalClose = $('modalClose');
    const openWaFooter = $('openWaFooter');

    function showError(msg){ errorBox.style.display='block'; errorBox.textContent=msg; successBox.style.display='none'; }
    function showSuccess(msg){ successBox.style.display='block'; successBox.textContent=msg; errorBox.style.display='none'; }
    function clearMsgs(){ errorBox.style.display='none'; successBox.style.display='none'; }

    function sanitizePhone(v){
      return v.replace(/[^0-9]/g,'');
    }
    function isValidPhone(v){
      const n = sanitizePhone(v);
      return n.length >= 8 && n.length <= 15;
    }
    function isValidAmount(v){
      return !isNaN(v) && Number(v) > 0;
    }
    function isValidCBUorAlias(v){
      const x = v.trim();
      if(!x) return false;
      const digits = x.replace(/\D/g,'');
      if(digits.length === 22) return true; // CBU exacto
      if(x.length >= 4 && x.length <= 50) return true; // posible alias
      return false;
    }

    // one per person per day: key by phone
    function getKeyForPhone(phone){
      const p = sanitizePhone(phone);
      return 'retiro:'+p;
    }
    function canRequestToday(phone){
      const key = getKeyForPhone(phone);
      const raw = localStorage.getItem(key);
      if(!raw) return true;
      try{
        const obj = JSON.parse(raw);
        // obj.date = 'YYYY-MM-DD'
        const today = new Date().toISOString().slice(0,10);
        return obj.date !== today;
      }catch(e){ return true }
    }
    function markRequestedToday(phone, payload){
      const key = getKeyForPhone(phone);
      const obj = { date: new Date().toISOString().slice(0,10), payload, ts: Date.now() };
      localStorage.setItem(key, JSON.stringify(obj));
    }

    // build whatsapp message
    function buildWhatsMessage(data){
      return encodeURIComponent(
        `Solicitud de RETIRO\nTeléfono: ${data.phone}\nUsuario: ${data.username}\nMonto: ${data.amount} ${data.currency}\nAlias/CBU: ${data.alias}\nBanco: ${data.bank || '-'}\nNota: ${data.note || '-'}\n\nSolicito retiro - 1 por día.`
      );
    }

    // open whatsapp
    function openWhats(data){
      const text = buildWhatsMessage(data);
      const waUrl = `https://wa.me/${WHATS_PHONE}?text=${text}`;
      window.open(waUrl,'_blank');
    }

    // form submit handler
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearMsgs();

      const phone = $('phone').value.trim();
      const username = $('username').value.trim();
      const amount = $('amount').value.trim();
      const currency = $('currency').value;
      const alias = $('alias').value.trim();
      const bank = $('bank').value.trim();
      const note = $('note').value.trim();
      const terms = $('terms').checked;

      // validations
      if(!isValidPhone(phone)){ showError('Teléfono inválido. Ingresá sólo números y código.'); return; }
      if(username.length < 2){ showError('Ingresá tu usuario.'); return; }
      if(!isValidAmount(amount)){ showError('Ingresá un monto válido mayor a 0.'); return; }
      if(!isValidCBUorAlias(alias)){ showError('Ingresá un Alias válido o un CBU (22 dígitos).'); return; }
      if(!terms){ showError('Debes confirmar que los datos son correctos.'); return; }

      // check 1-per-day
      if(!canRequestToday(phone)){
        showError('Ya registraste un retiro hoy con ese teléfono. Solo 1 retiro por persona cada 24 horas.');
        return;
      }

      const payload = {
        phone: sanitizePhone(phone),
        username,
        amount: Number(amount),
        currency,
        alias,
        bank,
        note,
        created_at: new Date().toISOString()
      };

      submitBtn.disabled = true;
      submitBtn.textContent = 'Enviando...';

      // intento enviar al endpoint (reemplazar /api/withdraw por tu ruta)
      try{
        const res = await fetch(API_ENDPOINT, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload),
        });

        if(res.ok){
          // marcar local
          markRequestedToday(phone, payload);
          showSuccess('Solicitud enviada correctamente. Te avisaremos por WhatsApp cuando se procese.');
          // track event pixel
          try{ fbq('track','CompleteRegistration',{value: payload.amount, currency: payload.currency, content_name:'Retiro'}); }catch(e){}
          // abrir modal
          modal.style.display='flex';
        } else {
          // si el servidor devuelve error, fallback a whatsapp
          const text = await res.text().catch(()=>null);
          showError('Hubo un problema procesando. Se abrirá WhatsApp para finalizar manualmente.');
          setTimeout(()=> openWhats(payload), 700);
        }
      }catch(err){
        // sin conexión al backend -> fallback a WhatsApp para cerrar retiro manualmente
        console.warn(err);
        showError('No se pudo conectar al servidor. Se abrirá WhatsApp para completar la solicitud.');
        openWhats(payload);
        // igualmente marcamos local (opcional) — comentá la siguiente línea si no querés marcarlo al fallback
        markRequestedToday(phone, payload);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Solicitar retiro';
      }
    });

    // botón abrir wa manual
    whatsBtn.addEventListener('click', ()=>{
      clearMsgs();
      const phone = $('phone').value.trim();
      const username = $('username').value.trim();
      const amount = $('amount').value.trim();
      const currency = $('currency').value;
      const alias = $('alias').value.trim();
      const bank = $('bank').value.trim();
      const note = $('note').value.trim();
      const payload = { phone: sanitizePhone(phone)||'--', username: username||'--', amount: amount||'--', currency, alias: alias||'--', bank, note };
      openWhats(payload);
    });

    // footer wa link
    openWaFooter.addEventListener('click', (e)=>{
      e.preventDefault();
      const payload = { phone:'--', username:'--', amount:'--', currency:'ARS', alias:'--', bank:'--', note:'soporte' };
      openWhats(payload);
    });

    // modal controls
    modalOk.addEventListener('click', ()=>{ modal.style.display='none' });
    modalClose.addEventListener('click', ()=>{ modal.style.display='none' });

    // accessibility: close modal on backdrop click
    document.getElementById('modal').addEventListener('click',(e)=>{ if(e.target === e.currentTarget) modal.style.display='none' });

    // small UX: phone input formatting - keep digits only on input
    $('phone').addEventListener('input', (e)=>{
      const v = e.target.value;
      const sanitized = v.replace(/[^\d\s\-]/g,'').replace(/\s{2,}/,' ');
      e.target.value = sanitized;
    });

    // demo: prefill for testing (quitá en producción)
    // $('phone').value = '11 6XXX XXXX';
    // $('username').value = 'usuario123';
  </script>
</body>
</html>
